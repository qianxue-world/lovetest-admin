# 导出激活码功能使用指南 / Export Codes Guide

## 功能概述 / Overview

导出功能允许管理员将所有激活码导出为纯文本文件（.txt），每行一个激活码，方便批量使用和备份。

## 特性 / Features

✅ **一键导出** - 点击按钮即可导出所有激活码
✅ **自动分页** - 自动获取所有页面的数据（后端分页）
✅ **纯文本格式** - 每行一个激活码，无其他信息
✅ **自动命名** - 文件名包含时间戳，便于管理
✅ **进度提示** - 导出过程中显示"导出中..."状态
✅ **成功反馈** - 显示导出的激活码数量

## 使用方法 / How to Use

### 步骤1：点击导出按钮

在激活码列表页面，点击绿色的 **"导出"** 按钮。

### 步骤2：等待导出完成

- 按钮显示"导出中..."
- 系统自动获取所有激活码（包括所有分页）
- 其他按钮在导出期间被禁用

### 步骤3：保存文件

- 浏览器自动下载文件
- 文件名格式：`activation-codes-YYYY-MM-DDTHH-MM-SS.txt`
- 例如：`activation-codes-2024-11-20T10-30-45.txt`

### 步骤4：查看导出结果

- 弹出提示框显示导出数量
- 例如："已导出 5000 个激活码"

## 文件格式 / File Format

导出的文件是纯文本格式，每行一个激活码：

```
CODE-001
CODE-002
CODE-003
TEST-ABC
PROD-2024-001
...
```

**特点：**
- 纯文本格式（UTF-8编码）
- 每行一个激活码
- 无标题行
- 无其他信息（状态、日期等）
- 适合直接使用或导入其他系统

## 使用场景 / Use Cases

### 场景1：批量分发

导出激活码后，可以：
- 通过邮件批量发送
- 导入到其他系统
- 打印成卡片

### 场景2：数据备份

定期导出激活码作为备份：
- 防止数据丢失
- 便于恢复
- 历史记录保存

### 场景3：数据迁移

从一个系统迁移到另一个系统：
- 导出所有激活码
- 导入到新系统
- 保持激活码一致性

### 场景4：统计分析

导出后使用其他工具分析：
- Excel统计
- 数据分析
- 报表生成

## 技术细节 / Technical Details

### 后端分页处理

由于激活码列表使用后端分页（skip token），导出功能会：

1. **循环请求所有页面**
   ```javascript
   while (hasMore) {
     const response = await getCodes(skipToken, 1000);
     allCodes.push(...response.codes);
     skipToken = response.nextSkipToken;
     hasMore = response.hasMore;
   }
   ```

2. **每次请求1000条**
   - 提高效率
   - 减少请求次数
   - 避免超时

3. **自动合并结果**
   - 将所有页面的激活码合并
   - 去重（如果需要）
   - 按顺序排列

### 文件生成

使用浏览器原生API生成和下载文件：

```javascript
// 创建文本内容
const content = allCodes.join('\n');

// 创建Blob对象
const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });

// 创建下载链接
const url = URL.createObjectURL(blob);
const link = document.createElement('a');
link.href = url;
link.download = 'activation-codes.txt';

// 触发下载
link.click();

// 清理
URL.revokeObjectURL(url);
```

### 文件名格式

文件名包含时间戳，格式：`activation-codes-YYYY-MM-DDTHH-MM-SS.txt`

示例：
- `activation-codes-2024-11-20T10-30-45.txt`
- `activation-codes-2024-12-01T15-20-30.txt`

## 性能考虑 / Performance

### 大量数据处理

如果有大量激活码（如10万+）：

1. **分批请求** - 每次1000条，避免单次请求过大
2. **内存管理** - 使用数组存储，JavaScript自动管理内存
3. **用户体验** - 显示"导出中..."状态，告知用户进度

### 预估时间

根据激活码数量：
- 1,000 条：< 1秒
- 10,000 条：1-2秒
- 100,000 条：5-10秒
- 1,000,000 条：30-60秒

**注意：** 实际时间取决于网络速度和服务器性能。

## 故障排查 / Troubleshooting

### 问题1：导出失败

**症状：** 显示"导出失败"错误

**可能原因：**
- 网络连接问题
- API服务器错误
- Token过期

**解决方法：**
1. 检查网络连接
2. 刷新页面重新登录
3. 查看浏览器控制台错误信息

### 问题2：文件未下载

**症状：** 点击导出后没有下载文件

**可能原因：**
- 浏览器阻止了下载
- 弹出窗口被拦截

**解决方法：**
1. 检查浏览器下载设置
2. 允许网站下载文件
3. 检查浏览器下载文件夹

### 问题3：导出时间过长

**症状：** 导出按钮一直显示"导出中..."

**可能原因：**
- 激活码数量太多
- 网络速度慢
- 服务器响应慢

**解决方法：**
1. 耐心等待
2. 检查网络连接
3. 如果超过5分钟，刷新页面重试

### 问题4：文件内容为空

**症状：** 下载的文件是空的

**可能原因：**
- 数据库中没有激活码
- API返回空数据

**解决方法：**
1. 检查是否有激活码
2. 查看浏览器控制台日志
3. 联系技术支持

## 安全建议 / Security Tips

### ⚠️ 重要提示

1. **保护导出文件** - 激活码是敏感数据，妥善保管
2. **不要公开分享** - 避免将文件上传到公共位置
3. **定期清理** - 删除不需要的导出文件
4. **加密存储** - 如需长期保存，建议加密
5. **访问控制** - 只有授权人员才能导出

### 最佳实践

1. **定期备份** - 每周或每月导出一次作为备份
2. **版本管理** - 保留多个版本的导出文件
3. **命名规范** - 使用有意义的文件名（已自动包含时间戳）
4. **存储位置** - 保存在安全的位置（如加密硬盘）
5. **审计日志** - 记录谁在何时导出了数据

## 与其他功能的配合 / Integration

### 配合批量删除

1. 导出激活码作为备份
2. 使用批量删除功能清理数据
3. 如需恢复，可以重新导入

### 配合搜索功能

1. 使用搜索功能过滤激活码
2. 导出功能会导出所有激活码（不受搜索影响）
3. 如需导出特定激活码，建议使用批量删除的预览功能

### 配合统计功能

1. 查看统计信息了解总数
2. 导出所有激活码
3. 验证导出数量与统计数量一致

## API端点 / API Endpoint

导出功能使用现有的查询端点：

```
GET /api/admin/codes?pageSize=1000&skipToken={token}
```

**参数：**
- `pageSize`: 每页数量（1000）
- `skipToken`: 分页令牌（可选）

**循环调用直到 `hasMore` 为 `false`**

## 更新日志 / Changelog

### v2.1.0 (2024-11-20)
- ✅ 新增导出功能
- ✅ 支持导出所有激活码
- ✅ 自动处理后端分页
- ✅ 纯文本格式输出
- ✅ 自动生成文件名（含时间戳）
- ✅ 完整的中英文支持

## 相关功能 / Related Features

- **批量删除** - 使用正则表达式批量删除激活码
- **搜索过滤** - 在列表中搜索特定激活码
- **统计信息** - 查看激活码统计数据

## 反馈 / Feedback

如有问题或建议，请提交 Issue 或 Pull Request。
