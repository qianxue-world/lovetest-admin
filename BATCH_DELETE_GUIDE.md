# 批量删除功能使用指南 / Batch Delete Guide

## 功能概述 / Overview

批量删除功能允许管理员使用模式匹配批量删除激活码，支持两种模式：
- **子串匹配**（默认）- 简单易用，匹配包含指定文本的激活码
- **正则表达式匹配** - 高级功能，支持复杂的匹配规则

## 使用步骤 / How to Use

### 1. 打开批量删除对话框

在激活码列表页面，点击 **"批量删除"** 按钮。

### 2. 输入匹配模式

#### 子串匹配模式（默认）

不勾选"使用正则表达式"，直接输入要匹配的文本：

**示例：**
- 输入 `TEST` → 匹配所有包含 "TEST" 的激活码
  - ✅ `TEST-001`
  - ✅ `MY-TEST-CODE`
  - ✅ `TESTING-123`
  - ❌ `DEMO-001`

- 输入 `2024` → 匹配所有包含 "2024" 的激活码
  - ✅ `CODE-2024-001`
  - ✅ `2024-PROD`
  - ❌ `CODE-2023-001`

#### 正则表达式模式（高级）

勾选"使用正则表达式"，输入正则表达式：

**常用示例：**

| 正则表达式 | 说明 | 匹配示例 |
|-----------|------|----------|
| `^TEST-.*` | 以 TEST- 开头 | TEST-001, TEST-ABC |
| `.*-2024$` | 以 -2024 结尾 | CODE-2024, PROD-2024 |
| `^DEMO-\d+$` | DEMO- 后跟纯数字 | DEMO-123, DEMO-456 |
| `^(TEST\|DEMO)-.*` | TEST 或 DEMO 开头 | TEST-001, DEMO-ABC |
| `.*OLD.*` | 包含 OLD | OLD-CODE, TESTOLD |
| `^[A-Z]{4}-\d{3}$` | 4个大写字母-3个数字 | TEST-123, PROD-456 |

### 3. 预览匹配结果

点击 **"预览匹配结果"** 按钮：
- 系统会显示匹配到的激活码数量
- 显示前10个匹配的激活码
- 如果超过10个，会显示"...还有 X 个"

**重要：** 这是试运行模式，不会实际删除任何数据！

### 4. 确认删除

如果预览结果正确：
1. 点击 **"确认删除"** 按钮
2. 在弹出的确认对话框中点击"确定"
3. 系统执行删除操作
4. 显示删除结果

如果预览结果不对：
- 点击 **"返回"** 按钮
- 修改匹配模式
- 重新预览

## 使用场景 / Use Cases

### 场景1：删除测试数据

**需求：** 删除所有测试激活码（以 TEST- 开头）

**操作：**
1. 勾选"使用正则表达式"
2. 输入：`^TEST-.*`
3. 预览 → 确认 → 删除

或者（简单模式）：
1. 不勾选正则
2. 输入：`TEST`
3. 预览 → 确认 → 删除

### 场景2：删除特定年份的激活码

**需求：** 删除2023年的所有激活码

**操作：**
1. 不勾选正则
2. 输入：`2023`
3. 预览 → 确认 → 删除

### 场景3：删除特定前缀的激活码

**需求：** 删除 DEMO- 或 TEST- 开头的激活码

**操作：**
1. 勾选"使用正则表达式"
2. 输入：`^(DEMO|TEST)-.*`
3. 预览 → 确认 → 删除

### 场景4：删除包含特定关键词的激活码

**需求：** 删除所有包含 "OLD" 的激活码

**操作：**
1. 不勾选正则
2. 输入：`OLD`
3. 预览 → 确认 → 删除

## 安全提示 / Safety Tips

### ⚠️ 重要警告

1. **删除操作不可撤销** - 删除后无法恢复
2. **先预览再删除** - 务必先查看预览结果
3. **谨慎使用通配符** - 避免误删重要数据
4. **备份重要数据** - 删除前建议备份数据库

### ✅ 最佳实践

1. **使用试运行** - 总是先预览匹配结果
2. **从小范围开始** - 先测试小批量删除
3. **使用具体模式** - 避免过于宽泛的匹配规则
4. **记录操作** - 记录删除的模式和数量
5. **定期清理** - 定期删除过期和测试数据

## 正则表达式速查 / Regex Quick Reference

### 基本语法

| 符号 | 说明 | 示例 |
|-----|------|------|
| `.` | 任意单个字符 | `a.c` 匹配 abc, a1c |
| `*` | 前面字符0次或多次 | `ab*c` 匹配 ac, abc, abbc |
| `+` | 前面字符1次或多次 | `ab+c` 匹配 abc, abbc |
| `?` | 前面字符0次或1次 | `ab?c` 匹配 ac, abc |
| `^` | 字符串开头 | `^TEST` 匹配以TEST开头 |
| `$` | 字符串结尾 | `2024$` 匹配以2024结尾 |
| `\d` | 数字 | `\d+` 匹配一个或多个数字 |
| `\w` | 字母数字下划线 | `\w+` 匹配单词 |
| `[abc]` | a或b或c | `[ABC]` 匹配A或B或C |
| `[a-z]` | a到z的任意字符 | `[A-Z]` 匹配大写字母 |
| `(a\|b)` | a或b | `(TEST\|DEMO)` 匹配TEST或DEMO |

### 常用模式

```regex
# 匹配特定前缀
^PREFIX-.*

# 匹配特定后缀
.*-SUFFIX$

# 匹配特定格式（4字母-3数字）
^[A-Z]{4}-\d{3}$

# 匹配包含特定文本
.*KEYWORD.*

# 匹配多个前缀之一
^(TEST|DEMO|PROD)-.*

# 匹配日期格式（YYYY-MM-DD）
^\d{4}-\d{2}-\d{2}$
```

## API 端点 / API Endpoint

### POST /api/admin/codes/batch-delete

**请求体：**
```json
{
  "pattern": "^TEST-.*",
  "dryRun": false
}
```

**参数说明：**
- `pattern` (string, 必填) - 正则表达式模式
- `dryRun` (boolean, 可选) - 试运行模式，默认 false

**响应：**
```json
{
  "success": true,
  "message": "Successfully deleted 150 codes",
  "matchedCount": 150,
  "deletedCount": 150,
  "matchedCodes": ["TEST-001", "TEST-002", "..."],
  "wasDryRun": false
}
```

## 故障排查 / Troubleshooting

### 问题1：正则表达式错误

**症状：** 显示"Invalid regex pattern"错误

**解决：**
- 检查正则表达式语法
- 确保特殊字符正确转义
- 使用在线正则测试工具验证

### 问题2：匹配结果为0

**症状：** 预览显示"找到 0 个匹配的激活码"

**解决：**
- 检查模式是否正确
- 尝试使用更宽泛的模式
- 确认数据库中确实存在匹配的激活码

### 问题3：匹配了不想删除的激活码

**症状：** 预览结果包含不应该删除的激活码

**解决：**
- 点击"返回"按钮
- 使用更精确的匹配模式
- 使用正则表达式的 `^` 和 `$` 限定开头和结尾

## 示例场景 / Example Scenarios

### 示例1：清理所有测试数据

```
模式：TEST
模式类型：子串匹配
预期匹配：所有包含"TEST"的激活码
```

### 示例2：删除2023年的激活码

```
模式：^.*-2023-.*$
模式类型：正则表达式
预期匹配：CODE-2023-001, PROD-2023-ABC
```

### 示例3：删除临时激活码

```
模式：TEMP
模式类型：子串匹配
预期匹配：TEMP-001, MY-TEMP-CODE
```

### 示例4：删除特定格式的激活码

```
模式：^DEMO-\d{6}$
模式类型：正则表达式
预期匹配：DEMO-123456, DEMO-789012
不匹配：DEMO-ABC, DEMO-12345
```

## 相关功能 / Related Features

- **删除过期激活码** - 自动删除所有已过期的激活码
- **单个删除** - 在列表中删除单个激活码
- **搜索过滤** - 使用搜索框过滤激活码

## 更新日志 / Changelog

### v2.1.0 (2024-11-20)
- ✅ 新增批量删除功能
- ✅ 支持子串匹配和正则表达式匹配
- ✅ 添加预览功能（试运行模式）
- ✅ 完整的中英文支持

## 反馈 / Feedback

如有问题或建议，请提交 Issue 或 Pull Request。
